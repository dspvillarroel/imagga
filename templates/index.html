<!DOCTYPE html>
<html>
<head>
    <title>Imagga Image Analysis</title>
    <style>
        .image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        .image-card {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            width: 300px;
        }
        .image-card img {
            width: 100%;
            height: auto;
        }
        .tags {
            margin-top: 10px;
        }
        .tag {
            background-color: #f0f0f0;
            padding: 5px;
            margin: 3px;
            border-radius: 3px;
            display: inline-block;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Analizador de Imágenes con Imagga</h1>
    
    <!-- Formulario de subida -->
    <form method="POST" enctype="multipart/form-data">
        <h2>Subir imágenes (máx. 3)</h2>
        <input type="file" name="file" multiple accept="image/*">
        <button type="submit">Subir y Analizar</button>
    </form>
    
    <!-- Resultados de subida -->
    {% if upload_results %}
        <h2>Resultados del Análisis</h2>
        <div class="image-container">
            {% for image in upload_results %}
                <div class="image-card">
                    <img src="{{ url_for('uploaded_file', filename=image.filename) }}">
                    {% if image.error %}
                        <p class="error">{{ image.error }}</p>
                    {% elif image.tags %}
                        <div class="tags">
                            <h3>Etiquetas:</h3>
                            {% for tag in image.tags %}
                                {% if tag %}
                                    <div class="tag">{{ tag.tag }} ({{ tag.confidence|round(1) }}%)</div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>No se encontraron etiquetas</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <!-- Historial de análisis -->
    <form method="POST">
        <h2>Imágenes Analizadas</h2>
        <button type="submit" name="analyze">Mostrar Historial</button>
    </form>
    
    {% if images %}
        <div class="image-container">
            {% for image in images %}
                <div class="image-card">
                    <img src="{{ url_for('uploaded_file', filename=image.filename) }}">
                    {% if image.tags %}
                        <div class="tags">
                            <h3>Etiquetas:</h3>
                            {% for tag in image.tags %}
                                {% if tag %}
                                    <div class="tag">{{ tag.tag }} ({{ tag.confidence|round(1) }}%)</div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>No se encontraron etiquetas</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}
</body>
</html>